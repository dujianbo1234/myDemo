<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="./gateone.js" type="text/javascript"></script>
    <title>Gate One</title>
  </head>
  <body>

<!-- Decide where you want to put Gate One -->
    <div id="gateone_container">
        <div id="gateone"></div>
    </div>
    
    
   <script type="text/javascript">
window.onload = function() {
    localStorage.clear()
        // 获取地址栏上的id
        function getQueryVariable(variable){
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            var pair;
            for (var i=0;i<vars.length;i++) {
                      pair = vars[i].split("=");
                    if(pair[0] == variable){return pair[1];}
            }
            return(false);
        }
        var urls = unescape(getQueryVariable("id"))
        console.log(urls)

        /**
         * upn - username
         * timestamp
         * signature: A valid HMAC signature that is generated from the api_key, upn, and timestamp (in that order).
         */
        var api_keys = urls.slice(Number(urls.indexOf('api_key')+8),Number(urls.indexOf('sshUrl')-1))
        var upns = urls.slice(Number(urls.indexOf('upn')+4),Number(urls.indexOf('signature')-1))
        var timestamps = urls.slice(Number(urls.indexOf('timestamp')+10),Number(urls.length-1))
        var signatures = urls.slice(Number(urls.indexOf('signature')+10),Number(urls.indexOf('api_key')-1))
        var auth = {
            'api_key': api_keys,
            // 'upn': upns,
            'upn': 'bomc',
            'timestamp': timestamps,
            'signature': signatures,
            'signature_method': 'HMAC-SHA1',
            'api_version': '1.0'    
        };
        console.log(auth)
        var autoConnectURLk = urls.slice(Number(urls.indexOf('sshUrl')+7),Number(urls.indexOf('gateoneUrl')-1))
        var urlk = urls.slice(Number(urls.indexOf('gateoneUrl')+11),Number(urls.indexOf('timestamp')-1))
        console.log(urlk)
        console.log(autoConnectURLk)
        // Initialize Gate One:
        GateOne.init({
            auth: auth, 
            url: urlk, 
            theme: 'solarized',
            goDiv: '#gateone',
            disableTermTransitions:'true',
            autoConnectURL:autoConnectURLk,
            // autoConnectURL:'ssh://bomc@192.168.127.244',
            showToolbar: true
        });
		// GateOne.autoConnect();
    }
</script>
  </body>
  
</html>